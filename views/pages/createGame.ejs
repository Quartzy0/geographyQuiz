<!doctype html>
<html lang="en">
<head>
    <title>Profile</title>

    <script src="/socket.io/socket.io.js"></script>
    <script>

        let xhttp;
        var socket;

        function load() {
            if (window.XMLHttpRequest) {
                // code for modern browsers
                xhttp = new XMLHttpRequest();
            } else {
                // code for old IE browsers
                xhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
        }

        function onLoad() {
            load();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    socket = io();
                    socket.emit('myIdentificationIsHere', {pin: this.responseText, iAmMaster: true});
                    var text = this.responseText;
                    socket.on('statusUpdate', function (data) {
                        if (data.value==="urOk."){
                            document.getElementById("Pin").innerText = 'Pin: ' + text;
                        }else {
                            document.getElementById("Pin").innerText = "An unexpected error occurred!";
                        }
                    });
                    socket.on('guyJoined', function (data) {
                        let newListElement = document.createElement("li");
                        let newListElementText = document.createTextNode(data.name);
                        newListElement.setAttribute('id', data.name);

                        newListElement.appendChild(newListElementText);
                        document.getElementById("list").appendChild(newListElement);
                    });
                    socket.on('nerdLeft_lolNoob', function (data) {
                        var ul = document.getElementById("list");
                        var candidate = document.getElementById(data.lozerWhoLeft);
                        ul.removeChild(candidate);
                    });
                }
            };
            xhttp.open("POST", "/createSession", true);
            xhttp.setRequestHeader('Content-Type', 'application/json');
            xhttp.send();
        }
    </script>

    <style>
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        li {
            float: left;
            padding: 16px;
            font-size: 40px;
            color: #FFFFFF;
        }

        li:hover {
            color: #CCCCCC;
        }
    </style>

    <% include ../partials/head.ejs %>
</head>

<body style="background-color: #56baed;" onload="onLoad()">

<!--    position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);-->

    <div class="card" style="position: absolute; left: 50%; top: 10%; transform: translate(-50%, -50%);">
        <div class="card-body">
            <h1 id="Pin" style="font-size: 60px">Connecting...</h1>
        </div>
    </div>

    <div>
        <ul style="position: absolute; left: 50%; top: 40%; transform: translate(-50%, -50%);" id="list">

        </ul>
    </div>



<% include ../partials/bootsrapScripts.ejs %>
</body>
</html>